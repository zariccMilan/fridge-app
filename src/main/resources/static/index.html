<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fridge App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { margin-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
        .section { margin-bottom: 30px; }
        button { padding: 4px 8px; margin-top: 5px; }
        form { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; }
        form input { padding: 4px 6px; width: 100%; box-sizing: border-box; }
        .row { display: flex; gap: 10px; width: 100%; }
        .row > div { flex: 1; min-width: 150px; }
        #message { margin-top: 10px; color: green; }
        #error { margin-top: 10px; color: red; }
    </style>
</head>
<body>

<h1>Fridge app</h1>

<div class="section">
    <h2>Categories</h2>
    <button id="refreshCategoriesBtn">Refresh categories</button>
    <table id="categoriesTable">
        <thead>
        <tr>
            <th>ID (UUID)</th>
            <th>Name</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<div class="section">
    <h2>Locations</h2>
    <button id="refreshLocationsBtn">Refresh locations</button>
    <table id="locationsTable">
        <thead>
        <tr>
            <th>ID (UUID)</th>
            <th>Name</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<div class="section">
    <h2>Fridge items</h2>
    <button id="refreshItemsBtn">Refresh items</button>
    <table id="itemsTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Quantity</th>
            <th>Best before</th>
            <th>Category</th>
            <th>Location</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

</div>

<div class="section">
    <h2>Add new fridge item</h2>
    <p>Use Category ID and Location ID from tables above (copy/paste UUID).</p>
    <form id="createForm">
        <div class="row">
            <div>
                <label>Name:<br>
                    <input type="text" id="name" required>
                </label>
            </div>
            <div>
                <label>Quantity:<br>
                    <input type="number" id="quantity" min="0" value="1" required>
                </label>
            </div>
            <div>
                <label>Best before (date):<br>
                    <input type="date" id="bestBefore" required>
                </label>
            </div>
        </div>
        <div class="row">
            <div>
                <label>Category ID:<br>
                    <input type="text" id="categoryId" placeholder="UUID from Categories table" required>
                </label>
            </div>
            <div>
                <label>Location ID:<br>
                    <input type="text" id="locationId" placeholder="UUID from Locations table" required>
                </label>
            </div>
        </div>
        <button type="submit">Create</button>
    </form>
    <div id="message"></div>
    <div id="error"></div>
    <h3>Update fridge item (quantity / bestBefore)</h3>
    <p>Enter existing item ID from table and new values (leave empty to skip field).</p>
    <form id="updateForm">
        <div class="row">
            <div>
                <label>Item ID:<br>
                    <input type="text" id="updateId" placeholder="Item UUID" required>
                </label>
            </div>
            <div>
                <label>New quantity:<br>
                    <input type="number" id="updateQuantity" min="0">
                </label>
            </div>
            <div>
                <label>New bestBefore (date):<br>
                    <input type="date" id="updateBestBefore">
                </label>
            </div>
        </div>
        <button type="submit">Update</button>
    </form>

    <h3>Create category</h3>
    <form id="createCategoryForm">
        <div class="row">
            <div>
                <label>Name:<br>
                    <input type="text" id="categoryNameInput" required>
                </label>
            </div>
        </div>
        <button type="submit">Create category</button>
    </form>
    <h3>Update category</h3>
    <p>Use Category ID from table above.</p>
    <form id="updateCategoryForm">
        <div class="row">
            <div>
                <label>Category ID:<br>
                    <input type="text" id="updateCategoryId" required>
                </label>
            </div>
            <div>
                <label>New name:<br>
                    <input type="text" id="updateCategoryName" required>
                </label>
            </div>
        </div>
        <button type="submit">Update category</button>
    </form>
    <h3>Create location</h3>
    <form id="createLocationForm">
        <div class="row">
            <div>
                <label>Name:<br>
                    <input type="text" id="locationNameInput" required>
                </label>
            </div>
        </div>
        <button type="submit">Create location</button>
    </form>
    <h3>Update location</h3>
    <p>Use Location ID from table above.</p>
    <form id="updateLocationForm">
        <div class="row">
            <div>
                <label>Location ID:<br>
                    <input type="text" id="updateLocationId" required>
                </label>
            </div>
            <div>
                <label>New name:<br>
                    <input type="text" id="updateLocationName" required>
                </label>
            </div>
        </div>
        <button type="submit">Update location</button>
    </form>





</div>

<script>

    const ITEMS_API = '/api/fridge/fridge-items';
    const CATEGORIES_API = '/api/fridge/categories';
    const ITEM_LOCATIONS_API = '/api/fridge/item-locations';

    const categoriesTableBody = document.querySelector('#categoriesTable tbody');
    const locationsTableBody = document.querySelector('#locationsTable tbody');
    const itemsTableBody = document.querySelector('#itemsTable tbody');

    const refreshCategoriesBtn = document.getElementById('refreshCategoriesBtn');
    const refreshLocationsBtn = document.getElementById('refreshLocationsBtn');
    const refreshItemsBtn = document.getElementById('refreshItemsBtn');

    const form = document.getElementById('createForm');
    const messageDiv = document.getElementById('message');
    const errorDiv = document.getElementById('error');
    const updateForm = document.getElementById('updateForm');
    const createCategoryForm = document.getElementById('createCategoryForm');
    const updateCategoryForm = document.getElementById('updateCategoryForm');
    const createLocationForm = document.getElementById('createLocationForm');
    const updateLocationForm = document.getElementById('updateLocationForm');





    function clearMessages() {
        messageDiv.textContent = '';
        errorDiv.textContent = '';
    }

    // CATEGORIES

    async function loadCategories() {
        try {
            const res = await fetch(CATEGORIES_API);
            if (!res.ok) {
                throw new Error('Failed to load categories, status ' + res.status);
            }
            const data = await res.json();
            renderCategories(data);
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error loading categories.';
        }
    }

    function renderCategories(categories) {
        categoriesTableBody.innerHTML = '';
        categories.forEach(cat => {
            const tr = document.createElement('tr');

            const idTd = document.createElement('td');
            idTd.textContent = cat.id;

            const nameTd = document.createElement('td');
            nameTd.textContent = cat.name;

            tr.appendChild(idTd);
            tr.appendChild(nameTd);
            categoriesTableBody.appendChild(tr);
        });
    }
    async function createCategory(event) {
        event.preventDefault();
        clearMessages();
        const name = document.getElementById('categoryNameInput').value.trim();
        if (!name) {
            errorDiv.textContent = 'Category name is required.';
            return;
        }
        try {
            const res = await fetch(CATEGORIES_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            });
            if (!res.ok) {
                const text = await res.text();
                throw new Error(text);
            }
            messageDiv.textContent = 'Category created.';
            createCategoryForm.reset();
            await loadCategories();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error creating category.';
        }
    }

    async function updateCategory(event) {
        event.preventDefault();
        clearMessages();
        const id = document.getElementById('updateCategoryId').value.trim();
        const name = document.getElementById('updateCategoryName').value.trim();
        if (!id || !name) {
            errorDiv.textContent = 'Category ID and new name are required.';
            return;
        }
        try {
            const res = await fetch(`${CATEGORIES_API}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            });
            if (!res.ok) {
                const text = await res.text();
                throw new Error(text);
            }
            messageDiv.textContent = 'Category updated.';
            updateCategoryForm.reset();
            await loadCategories();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error updating category.';
        }
    }


    // ITEM LOCATIONS

    async function loadLocations() {
        try {
            const res = await fetch(ITEM_LOCATIONS_API);
            if (!res.ok) {
                throw new Error('Failed to load locations, status ' + res.status);
            }
            const data = await res.json();
            renderLocations(data);
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error loading locations.';
        }
    }

    function renderLocations(locations) {
        locationsTableBody.innerHTML = '';
        locations.forEach(loc => {
            const tr = document.createElement('tr');

            const idTd = document.createElement('td');
            idTd.textContent = loc.id;

            const nameTd = document.createElement('td');
            nameTd.textContent = loc.name;

            tr.appendChild(idTd);
            tr.appendChild(nameTd);
            locationsTableBody.appendChild(tr);
        });
    }

    async function createLocation(event) {
        event.preventDefault();
        clearMessages();
        const name = document.getElementById('locationNameInput').value.trim();
        if (!name) {
            errorDiv.textContent = 'Location name is required.';
            return;
        }
        try {
            const res = await fetch(ITEM_LOCATIONS_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            });
            if (!res.ok) {
                const text = await res.text();
                throw new Error(text);
            }
            messageDiv.textContent = 'Location created.';
            createLocationForm.reset();
            await loadLocations();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error creating location.';
        }
    }

    async function updateLocation(event) {
        event.preventDefault();
        clearMessages();
        const id = document.getElementById('updateLocationId').value.trim();
        const name = document.getElementById('updateLocationName').value.trim();
        if (!id || !name) {
            errorDiv.textContent = 'Location ID and new name are required.';
            return;
        }
        try {
            const res = await fetch(`${ITEM_LOCATIONS_API}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            });
            if (!res.ok) {
                const text = await res.text();
                throw new Error(text);
            }
            messageDiv.textContent = 'Location updated.';
            updateLocationForm.reset();
            await loadLocations();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error updating location.';
        }
    }


    // FRIDGE ITEMS

    async function loadItems() {
        try {
            const res = await fetch(ITEMS_API);
            if (!res.ok) {
                throw new Error('Failed to load items, status ' + res.status);
            }
            const data = await res.json();
            renderItems(data);
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error loading items.';
        }
    }

    function renderItems(items) {
        itemsTableBody.innerHTML = '';
        items.forEach(item => {
            const tr = document.createElement('tr');

            const idTd = document.createElement('td');
            idTd.textContent = item.id;

            const nameTd = document.createElement('td');
            nameTd.textContent = item.name;

            const quantityTd = document.createElement('td');
            quantityTd.textContent = item.quantity;

            const bestBeforeTd = document.createElement('td');
            bestBeforeTd.textContent = item.bestBefore;

            const categoryTd = document.createElement('td');
            categoryTd.textContent = item.categoryName || item.categoryId;

            const locationTd = document.createElement('td');
            locationTd.textContent = item.locationName || item.locationId;

            const actionsTd = document.createElement('td');
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.onclick = () => deleteItem(item.id);
            actionsTd.appendChild(deleteBtn);

            tr.appendChild(idTd);
            tr.appendChild(nameTd);
            tr.appendChild(quantityTd);
            tr.appendChild(bestBeforeTd);
            tr.appendChild(categoryTd);
            tr.appendChild(locationTd);
            tr.appendChild(actionsTd);

            itemsTableBody.appendChild(tr);
        });
    }
    async function updateItem(event) {
        event.preventDefault();
        clearMessages();

        const id = document.getElementById('updateId').value.trim();
        const quantityStr = document.getElementById('updateQuantity').value;
        const bestBefore = document.getElementById('updateBestBefore').value;

        if (!id) {
            errorDiv.textContent = 'Item ID is required.';
            return;
        }

        const body = {};
        if (quantityStr !== '') {
            body.quantity = Number(quantityStr);
        }
        if (bestBefore) {
            body.bestBefore = bestBefore;
        }

        if (Object.keys(body).length === 0) {
            errorDiv.textContent = 'Nothing to update.';
            return;
        }

        try {
            const res = await fetch(`${ITEMS_API}/${id}`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const text = await res.text();
                throw new Error('Failed to update item: ' + text);
            }

            messageDiv.textContent = 'Item updated.';
            updateForm.reset();
            await loadItems();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error updating item.';
        }
    }



    async function createItem(event) {
        event.preventDefault();
        clearMessages();

        const name = document.getElementById('name').value.trim();
        const quantity = Number(document.getElementById('quantity').value);
        const bestBefore = document.getElementById('bestBefore').value;
        const categoryId = document.getElementById('categoryId').value.trim();
        const locationId = document.getElementById('locationId').value.trim();

        if (!name || !bestBefore || !categoryId || !locationId) {
            errorDiv.textContent = 'All fields are required.';
            return;
        }

        const body = {
            name,
            quantity,
            bestBefore,
            categoryId,
            locationId
        };

        try {
            const res = await fetch(ITEMS_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const text = await res.text();
                throw new Error('Failed to create item: ' + text);
            }

            messageDiv.textContent = 'Item created.';
            form.reset();
            await loadItems();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error creating item.';
        }
    }

    async function deleteItem(id) {
        clearMessages();
        if (!confirm('Delete item?')) {
            return;
        }
        try {
            const res = await fetch(`${ITEMS_API}/${id}`, {
                method: 'DELETE'
            });
            if (!res.ok && res.status !== 204) {
                throw new Error('Failed to delete, status ' + res.status);
            }
            messageDiv.textContent = 'Item deleted.';
            await loadItems();
        } catch (e) {
            console.error(e);
            errorDiv.textContent = 'Error deleting item.';
        }
    }




    refreshCategoriesBtn.addEventListener('click', loadCategories);
    refreshLocationsBtn.addEventListener('click', loadLocations);
    refreshItemsBtn.addEventListener('click', loadItems);
    form.addEventListener('submit', createItem);
    updateForm.addEventListener('submit', updateItem);
    createCategoryForm.addEventListener('submit', createCategory);
    updateCategoryForm.addEventListener('submit', updateCategory);
    createLocationForm.addEventListener('submit', createLocation);
    updateLocationForm.addEventListener('submit', updateLocation);






    loadCategories();
    loadLocations();
    loadItems();
</script>

</body>
</html>
